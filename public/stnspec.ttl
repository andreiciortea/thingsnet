@base <http://www.thingsnet.com/> .
@prefix stn: <http://purl.org/stn/core#> .
@prefix stn-ops: <http://purl.org/stn/operations#> .
@prefix stn-http: <http://purl.org/stn/http#> .
@prefix http: <http://www.w3.org/2011/http#> .

<#platform>
    a stn:Platform ;
    stn:name "ThingsNet" ;
    stn-http:baseURL <http://localhost:9000> ;
    stn-http:supportsAuth stn-http:WebID ;
    stn-ops:consumes stn-http:Turtle ;
    stn-ops:produces stn-http:Turtle ;
    stn-ops:supports <#createAccount> ,
        <#getAccount> ,
        <#getAccountForAgent> ,
        <#deleteAccount> ,
        <#createConnection> ,
        <#getConnections> ,
        <#deleteConnection> ,
        <#sendMessage> ,
        <#getMessage> ,
        <#getMessages> ,
        <#deleteMessage> .


#
# Account operations
#

<#thingsnetAccount>
    a stn:UserAccount ;
    stn:name
        [ stn-ops:DisplayedName ;
            stn-ops:required true;
        ] ;
    stn:heldBy
        [ a stn-ops:SocialThing ;
            stn:ownedBy stn-ops:Owner ;
            stn-ops:hasClass stn-ops:SocialThingClass ;
            stn-ops:required true ;
        ] ;
    stn:description
        [ stn-ops:Description ;
            stn-ops:required false ;
        ] .

<#createAccount>
    a stn-ops:CreateUserAccount ;
    stn-ops:implementedAs
        [ a stn-http:STNRequest ;
            http:methodName "POST" ;
            http:requestURI "/users" ;
            stn-http:requiresAuth false ;
        ] ;
    stn-ops:hasInput
        [ a stn-http:TurtleRepresentation ;
            stn-ops:representationOf <#thingsnetAccount> ;
            stn-ops:required true;
            stn-http:paramIn stn-http:Body;
        ] ;
    stn-ops:hasOutput
        [ a stn-http:TurtleRepresentation ;
            stn-ops:representationOf stn:UserAccount ;
        ] .

<#getAccount>
    a stn-ops:GetUserAccount ;
    stn-ops:implementedAs
        [ a stn-http:STNRequest ;
            http:methodName "GET" ;
            http:requestURI ":accountUri" ;
            stn-http:requiresAuth true ;
        ] ;
    stn-ops:hasInput
        [ a stn-ops:UserAccountURI ;
            stn-ops:required true ;
            stn-ops:paramName "accountUri" ;
            stn-http:paramIn stn-http:Path ;
        ] ;
    stn-ops:hasOutput
        [ a stn:TurtleRepresentation ;
            stn-ops:representationOf stn:UserAccount ;
        ] .

<#getAccountForAgent>
    a stn-ops:GetUserAccountForAgent ;
    stn-ops:implementedAs
        [ a stn-http:STNRequest ;
            http:methodName "GET" ;
            http:requestURI "/users" ;
            stn-http:requiresAuth true ;
        ] ;
    stn-ops:hasInput
        [ a stn-ops:AgentURI ;
            stn-ops:paramName "userWebID" ;
            stn-http:paramIn stn-http:Query ;
            stn-ops:required true ;
        ] ;
    stn-ops:hasOutput
        [ a stn:TurtleRepresentation ;
            stn-ops:representationOf stn:UserAccount ;
        ] .

<#deleteAccount>
    a stn-ops:DeleteUserAccount ;
    stn-ops:implementedAs
        [ a stn-http:STNRequest ;
            http:methodName "DELETE" ;
            http:requestURI "/users" ;
            stn-http:requiresAuth true ;
        ] .


#
# Connection operations
#

<#conectionPatch>
    a stn:UserAccount ;
    stn:connectedTo
        [ a stn-ops:EntityURI ;
            stn-ops:required true ;
        ] .

<#createConnection>
    a stn-ops:CreateConnectionTo;
    stn-ops:implementedAs
        [ a stn-http:STNRequest ;
            http:methodName "POST" ;
            http:requestURI "/connections" ;
            stn-http:requiresAuth true ;
        ] ;
    stn-ops:hasInput
        [ a stn-http:TurtleRepresentation ;
            stn-ops:representationOf <#conectionPatch> ;
            stn-ops:required true;
            stn-http:paramIn stn-http:Body;
        ] ;
    stn-ops:hasOutput
        [ a stn:TurtleRepresentation ;
            stn-ops:representationOf stn:UserAccount ;
        ] .

<#deleteConnection>
    a stn-ops:DeleteConnectionTo ;
    stn-ops:implementedAs
        [ a stn-http:STNRequest ;
            http:methodName "DELETE" ;
            http:requestURI "/connections" ;
            stn-http:requiresAuth true ;
        ] ;
    stn-ops:hasInput
        [ a stn-http:TurtleRepresentation ;
            stn-ops:representationOf <#conectionPatch> ;
            stn-ops:required true;
            stn-http:paramIn stn-http:Body;
        ] ;
    stn-ops:hasOutput
        [ a stn:TurtleRepresentation ;
            stn-ops:representationOf stn:UserAccount ;
        ] .


#
# Message operations
#

<#thingsnetMessage>
    a stn:Message ;
    stn:hasSender
        [ a stn-ops:UserAccountURI ;
            stn-ops:required false ;
        ] ;
    stn:hasReceiver
        [ a stn-ops:UserAccountURI ;
            stn-ops:required true ;
        ] ;
    stn:replyTo
        [ a stn-ops:MessageURI ;
            stn-ops:required false ;
        ] ;
    stn:hasSubject
        [ a xsd:String ;
            stn-ops:required false ;
        ] ;
    stn:hasBody
        [ a xsd:String ;
            stn-ops:required false ;
        ] .

<#sendMessage>
    a stn-ops:SendPrivateMessage;
    stn-ops:implementedAs
        [ a stn-http:STNRequest ;
            http:methodName "POST" ;
            http:requestURI "/messages" ;
            stn-http:requiresAuth true ;
        ] ;
    stn-ops:hasInput
        [ a stn-http:TurtleRepresentation ;
            stn-ops:representationOf <#thingsnetMessage> ;
            stn-ops:required true;
            stn-http:paramIn stn-http:Body;
        ] ;
    stn-ops:hasOutput
        [ a stn:TurtleRepresentation ;
            stn-ops:representationOf stn:Message ;
        ] .

<#deleteMessage>
    a stn-ops:DeletePrivateMessage ;
    stn-ops:implementedAs
        [ a stn-http:STNRequest ;
            http:methodName "DELETE" ;
            http:requestURI ":messageUri" ;
            stn-http:requiresAuth true ;
        ] ;
    stn-ops:hasInput
        [ a stn-ops:MessageURI ;
            stn-ops:paramName "messageUri" ;
            stn-ops:required true;
            stn-http:paramIn stn-http:Path ;
        ] .

<#getMessage>
    a stn-ops:GetMessage ;
    stn-ops:implementedAs
        [ a stn-http:STNRequest ;
            http:methodName "GET" ;
            http:requestURI ":messageUri" ;
            stn-http:requiresAuth true ;
        ] ;
    stn-ops:hasInput
        [ a stn-ops:MessageURI ;
            stn-ops:paramName "messageUri" ;
            stn-ops:required true;
            stn-http:paramIn stn-http:Path ;
        ] ;
    stn-ops:hasOutput
        [ a stn:TurtleRepresentation ;
            stn-ops:representationOf stn:Message ;
        ] .

<#getMessages>
    a stn-ops:GetMessages ;
    stn-ops:implementedAs
        [ a stn-http:STNRequest ;
            http:methodName "GET" ;
            http:requestURI "/messages" ;
        ] ;
    stn-ops:hasOutputCollectionOf
        [ a stn:TurtleRepresentation ;
            stn-ops:representationOf <#thingsnetMessage> ;
        ] .
# check this out